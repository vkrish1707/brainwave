SELECT 
    gw.EBVP_TOP_NODE,
    gw.EBVP_TOP_NODE_2,
    gw.EBVP_TOP_NODE_3,
    gw.REPORTS_TO_3 AS VP,

    COUNT(DISTINCT gw.HC) AS Q2_TO_DATE_HC,

    COUNT(DISTINCT gr1.REQ) AS HIRED_BY_Q2,

    COUNT(DISTINCT gr2.REQ) AS OPEN_REQS_AFTER_Q2

FROM GLOBAL_WORKFORCE gw

-- Join for HIRED_BY_Q2
LEFT JOIN GLOBAL_REQUISITIONS gr1
    ON gw.EBVP_TOP_NODE = gr1.EBVP_TOP_NODE
    AND gw.EBVP_TOP_NODE_2 = gr1.EBVP_TOP_NODE_2
    AND gw.EBVP_TOP_NODE_3 = gr1.EBVP_TOP_NODE_3
    AND gr1.ACTUAL_START_DATE <= '2025-05-05'
    AND gr1.EMPLOYEE_GROUP IN ('A-Regular Salaried', 'B-Regular Hourly')

-- Join for OPEN_REQS_AFTER_Q2
LEFT JOIN GLOBAL_REQUISITIONS gr2
    ON gw.EBVP_TOP_NODE = gr2.EBVP_TOP_NODE
    AND gw.EBVP_TOP_NODE_2 = gr2.EBVP_TOP_NODE_2
    AND gw.EBVP_TOP_NODE_3 = gr2.EBVP_TOP_NODE_3
    AND gr2.ACTUAL_START_DATE >= '2025-07-01'
    AND gr2.STATUS IN ('Future Hire', 'Pending Approval', 'Opened', 'On Hold')
    AND gr2.EMPLOYEE_GROUP IN ('A-Regular Salaried', 'B-Regular Hourly')

WHERE gw.WEEK_NUM = 'WW1925'

GROUP BY 
    gw.EBVP_TOP_NODE,
    gw.EBVP_TOP_NODE_2,
    gw.EBVP_TOP_NODE_3,
    gw.REPORTS_TO_3